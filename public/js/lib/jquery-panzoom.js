(function(c){function h(){eventData={target:this};var a=this.data("panZoom");b.zoomIn&&(b.zoomIn.bind("mousedown.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseDown","zoomIn")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(a){a.preventDefault()}),a.bound_elements=a.bound_elements.add(b.zoomIn));b.zoomOut&&(b.zoomOut.bind("mousedown.panZoom",eventData,function(a){a.preventDefault();
a.data.target.panZoom("mouseDown","zoomOut")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(a){a.preventDefault()}),a.bound_elements=a.bound_elements.add(b.zoomOut));b.panUp&&(b.panUp.bind("mousedown.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseDown","panUp")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseUp")}).bind("click.panZoom",
function(a){a.preventDefault()}),a.bound_elements=a.bound_elements.add(b.panUp));b.panDown&&(b.panDown.bind("mousedown.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseDown","panDown")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(a){a.preventDefault()}),a.bound_elements=a.bound_elements.add(b.panDown));b.panLeft&&(b.panLeft.bind("mousedown.panZoom",eventData,function(a){a.preventDefault();
a.data.target.panZoom("mouseDown","panLeft")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseUp")}).bind("click.panZoom",function(a){a.preventDefault()}),a.bound_elements=a.bound_elements.add(b.panLeft));b.panRight&&(b.panRight.bind("mousedown.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseDown","panRight")}).bind("mouseleave.panZoom mouseup.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("mouseUp")}).bind("click.panZoom",
function(a){a.preventDefault()}),a.bound_elements=a.bound_elements.add(b.panRight));b.fit&&(b.fit.bind("click.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("fit")}),a.bound_elements=a.bound_elements.add(b.fit));b.destroy&&(b.destroy.bind("click.panZoom",eventData,function(a){a.preventDefault();a.data.target.panZoom("destroy")}),a.bound_elements=a.bound_elements.add(b.destroy));b.double_click&&this.bind("dblclick.panZoom",eventData,function(a){a.data.target.panZoom("zoomIn")});
b.mousewheel&&"function"==typeof this.mousewheel?(this.parent().bind("mousewheel.panZoom",function(a,b){a.preventDefault();c(this).find("img").panZoom("mouseWheel",b)}),a.bound_elements=a.bound_elements.add(this.parent())):b.mousewheel&&alert("Mousewheel requires jquery-mousewheel by Brandon Aaron (https://github.com/brandonaaron/jquery-mousewheel) - please include it or disable mousewheel to remove this warning.");b.directedit&&(c(b.out_x1).add(b.out_y1).add(b.out_x2).add(b.out_y2).bind("change.panZoom blur.panZoom",
eventData,function(a){a.data.target.panZoom("readPosition")}),a.bound_elements=a.bound_elements.add(c(b.out_x1).add(b.out_y1).add(b.out_x2).add(b.out_y2)));b.draggable&&"function"==typeof this.draggable?this.draggable({stop:function(){c(this).panZoom("dragComplete")}}):b.draggable&&alert("Draggable requires jQuery UI - please include jQuery UI or disable draggable to remove this warning.");c(this).bind("load.panZoom",eventData,function(a){a.data.target.panZoom("loadImage")});a.bound_elements=a.bound_elements.add(this)}
function j(){this.data("panZoom",{target_element:this,target_dimensions:{x:null,y:null},viewport_element:this.parent(),viewport_dimensions:{x:this.parent().width(),y:this.parent().height()},position:{x1:null,y1:null,x2:null,y2:null},last_image:null,loaded:!1,mousewheel_delta:0,mousedown_interval:!1,bound_elements:c()});b.debug&&console.log(this.data("panZoom"))}function k(){"static"==this.parent().css("position")&&this.parent().css("position","relative");this.css({position:"absolute",top:0,left:0});
b.draggable&&this.css({cursor:"move"})}function l(){var a=this.data("panZoom");if(a.position.x2-a.position.x1<b.min_width/b.factor||a.position.y2-a.position.y1<b.min_height/b.factor)0==a.position.x2||0==a.position.y2?d.fit.apply(this):(a.position.x2-a.position.x1<b.min_width/b.factor&&(a.position.x2=1*a.position.x1+b.min_width/b.factor),a.position.y2-a.position.y1<b.min_height/b.factor&&(a.position.y2=1*a.position.y1+b.min_height/b.factor));b.aspect&&(target=a.target_dimensions.ratio,current=m.apply(this),
current>target?(new_width=f.apply(this)*target,diff=g.apply(this)-new_width,a.position.x1=1*a.position.x1+diff/2,a.position.x2=1*a.position.x2-diff/2):current<target&&(new_height=g.apply(this)/target,diff=f.apply(this)-new_height,a.position.y1=1*a.position.y1+diff/2,a.position.y2=1*a.position.y2-diff/2))}function n(){var a=this.data("panZoom");width=g.apply(this);height=f.apply(this);left_offset=p.apply(this);top_offset=q.apply(this);properties={top:Math.round(top_offset),left:Math.round(left_offset),
width:Math.round(width),height:Math.round(height)};a.loaded&&b.animate?r.apply(this,[properties]):s.apply(this,[properties]);b.debug&&(console.log("--"),console.log("width:"+width),console.log("height:"+height),console.log("left:"+left_offset),console.log("top:"+top_offset))}function s(){this.css(properties)}function r(){this.stop().animate(properties,b.animate_duration,b.animate_easing)}function g(){var a=this.data("panZoom");return width=a.position.x2-a.position.x1}function p(){return this.data("panZoom").position.x1}
function f(){var a=this.data("panZoom");return height=a.position.y2-a.position.y1}function q(){return top_offset=this.data("panZoom").position.y1}function m(){return g.apply(this)/f.apply(this)}function t(){var a=this.data("panZoom");b.out_x1&&b.out_x1.val(Math.round(a.position.x1/b.factor));b.out_y1&&b.out_y1.val(Math.round(a.position.y1/b.factor));b.out_x2&&b.out_x2.val(Math.round(a.position.x2/b.factor));b.out_y2&&b.out_y2.val(Math.round(a.position.y2/b.factor))}function e(){var a=this.data("panZoom");
return ret={zoom:{x:b.zoom_step/100*a.viewport_dimensions.x,y:b.zoom_step/100*a.viewport_dimensions.y},pan:{x:b.pan_step/100*a.viewport_dimensions.x,y:b.pan_step/100*a.viewport_dimensions.y}}}function u(){var a=this.data("panZoom"),b=document.createElement("img");b.src=this.attr("src");b.id="jqpz-temp";c("body").append(b);a.target_dimensions.x=c("#jqpz-temp").width();a.target_dimensions.y=c("#jqpz-temp").height();c("#jqpz-temp").remove();a.target_dimensions.ratio=a.target_dimensions.x/a.target_dimensions.y}
c.fn.panZoom=function(a){if(d[a])return d[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||!a)return d.init.apply(this,arguments);c.error("Method "+a+" does not exist")};c.fn.panZoom.defaults={zoomIn:!1,zoomOut:!1,panUp:!1,panDown:!1,panLeft:!1,panRight:!1,fit:!1,destroy:!1,out_x1:!1,out_y1:!1,out_x2:!1,out_y2:!1,min_width:20,min_height:20,zoom_step:3,pan_step:3,debug:!1,directedit:!1,aspect:!0,factor:70,animate:!0,animate_duration:200,animate_easing:"linear",double_click:!0,
mousewheel:!0,mousewheel_delta:0.4,draggable:!0,clickandhold:!0};var b={},d={init:function(a){c.extend(b,c.fn.panZoom.defaults,a);k.apply(this);j.apply(this);h.apply(this);d.readPosition.apply(this)},destroy:function(){this.data("panZoom").bound_elements.unbind(".panZoom");b.draggable&&"function"==typeof this.draggable&&this.draggable("destroy");this.removeData("panZoom")},loadImage:function(){var a=this.data("panZoom");u.apply(this);d.updatePosition.apply(this);null!=a.last_image&&a.last_image!=this.attr("src")&&
d.fit.apply(this);a.last_image=this.attr("src");a.loaded=!0},readPosition:function(){var a=this.data("panZoom");b.out_x1&&(a.position.x1=b.out_x1.val()*b.factor);b.out_y1&&(a.position.y1=b.out_y1.val()*b.factor);b.out_x2&&(a.position.x2=b.out_x2.val()*b.factor);b.out_y2&&(a.position.y2=b.out_y2.val()*b.factor);d.updatePosition.apply(this)},updatePosition:function(){l.apply(this);t.apply(this);n.apply(this)},fit:function(){var a=this.data("panZoom");a.position.x1=0;a.position.y1=0;a.position.x2=a.viewport_dimensions.x;
a.position.y2=a.viewport_dimensions.y;d.updatePosition.apply(this)},zoomIn:function(a){var b=this.data("panZoom");"undefined"==typeof a&&(a=e.apply(this));b.position.x1=1*b.position.x1-a.zoom.x;b.position.x2=1*b.position.x2+a.zoom.x;b.position.y1=1*b.position.y1-a.zoom.y;b.position.y2=1*b.position.y2+a.zoom.y;d.updatePosition.apply(this)},zoomOut:function(a){var b=this.data("panZoom");"undefined"==typeof a&&(a=e.apply(this));b.position.x1=1*b.position.x1+a.zoom.x;b.position.x2=1*b.position.x2-a.zoom.x;
b.position.y1=1*b.position.y1+a.zoom.y;b.position.y2=1*b.position.y2-a.zoom.y;d.updatePosition.apply(this)},panUp:function(){var a=this.data("panZoom"),b=e.apply(this);a.position.y1-=b.pan.y;a.position.y2-=b.pan.y;d.updatePosition.apply(this)},panDown:function(){var a=this.data("panZoom"),b=e.apply(this);a.position.y1=1*a.position.y1+b.pan.y;a.position.y2=1*a.position.y2+b.pan.y;d.updatePosition.apply(this)},panLeft:function(){var a=this.data("panZoom"),b=e.apply(this);a.position.x1-=b.pan.x;a.position.x2-=
b.pan.x;d.updatePosition.apply(this)},panRight:function(){var a=this.data("panZoom"),b=e.apply(this);a.position.x1=1*a.position.x1+b.pan.x;a.position.x2=1*a.position.x2+b.pan.x;d.updatePosition.apply(this)},mouseWheel:function(a){var c=e.apply(this);c.zoom.x*=Math.abs(a)/b.mousewheel_delta;c.zoom.y*=Math.abs(a)/b.mousewheel_delta;0<a?d.zoomIn.apply(this,[c]):0>a&&d.zoomOut.apply(this,[c])},dragComplete:function(){var a=this.data("panZoom");a.position.x1=this.position().left;a.position.y1=this.position().top;
a.position.x2=1*this.position().left+this.width();a.position.y2=1*this.position().top+this.height();d.updatePosition.apply(this)},mouseDown:function(a){d[a].apply(this);if(b.clickandhold){var c=this.data("panZoom");d.mouseUp.apply(this);c.mousedown_interval=window.setInterval(function(a,b){a.panZoom(b)},b.animate_duration,this,a)}},mouseUp:function(){var a=this.data("panZoom");window.clearInterval(a.mousedown_interval)}}})(jQuery);