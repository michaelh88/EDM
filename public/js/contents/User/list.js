function refresh_fenetre(){oTable.fnDraw(!0)}function tableRowClick(){var e=oTable.fnGetData(this),t=parseInt(e[0]),s=parseInt(e[0]),r=$("div#user-form"),n=null;$("#projet").find("option").removeAttr("selected"),$("#utilisateur_id").val(t),change_user_value(),reInitUserFields(),r.attr("class","classic-form-user-view"),$.getJSON(userAjaxGetURL+s,function(e){r.find("input#user_id").val(e.id),r.find("input#user_email").val(e.email),r.find("input#user_username").val(e.username),r.find("input#user_lastname").val(e.userlastname),r.find("input#user_firstname").val(e.userfirstname),$("#user_logins").text(e.logins),$("#user_lastlogin").text(""==e.last_login?"Jamais connecté":e.last_login),r.find("input#user_password").val(""),r.find("input#user_password_confirm").val(""),r.find("select#role").val(e.role_id),r.find("select#projet").val(e.projet_id),$("#lbl_user_lastlogin").show(),$("#lbl_user_logins").show(),$("hr#horizontal-line").show(),$("div.error").hide(),0==e.canBeDeleted?$("#btn_delete").hide():$("#btn_delete").show()}),r.find("input#user_id").val(s),r.bPopup({onClose:function(){oTable.fnDraw()}}),n=new ItpOverlay;new Request.HTML({method:"get",onRequest:function(){n.show("user-form")},onComplete:function(){n.hide("user-form")}}).send()}function deleteClick(){{var e=$("input#user_username").val();askWarning("Êtes-vous sûr de vouloir supprimer l'utilisateur "+e+"?",function(){var e=$("div#user-form");user_id=e.find("input#user_id").val(),$.get(userAjaxDeleteURL+"/"+user_id,null,function(){e.bPopup().close()})})}}function showUserForm(){reInitUserFields(),$("#projet").find("option").removeAttr("selected");var e=$("div#user-form");e.attr("class","classic-form-user-insert"),e.find("input#user_id").val(""),e.find("input#user_email").val(""),e.find("input#user_username").val(""),e.find("input#user_lastname").val(""),e.find("input#user_firstname").val(""),e.find("input#user_password").val(""),e.find("input#user_password_confirm").val(""),e.find("select#role").val(""),$("#user_logins").text(""),$("#user_lastlogin").text(""),$("#lbl_user_lastlogin").hide(),$("#lbl_user_logins").hide(),$("hr#horizontal-line").hide(),$("div.error").hide(),e.bPopup({onClose:function(){oTable.fnDraw()}})}function resizeDataTable(){$("div.datatable-container").width($(window).width()-60),oTable.fnAdjustColumnSizing()}function reInitUserFields(){$("div#user-form").find("input#user_email, input#user_username, input#user_lastname, input#user_firstname, input#user_password, input#user_password_confirm").css("backgroundColor","#ffffff")}function insertUser(){var e=$("div#user-form");return val_role=e.find("input#role").val(),val_proj=e.find("input#projet").val(),"2"!=val_role&&"4"!=val_role||"0"!=val_proj?(reInitUserFields(),void $.post(userPostInsertURL,{id:e.find("input#user_id").val(),email:e.find("input#user_email").val(),username:e.find("input#user_username").val(),userlastname:e.find("input#user_lastname").val(),userfirstname:e.find("input#user_firstname").val(),password:e.find("input#user_password").val(),password_confirm:e.find("input#user_password_confirm").val(),projet:e.find("select#projet").val(),role:e.find("select#role").val()},function(e){var t=null;if(t=$.parseJSON(e),0==t.status)$("div.message").html(t.message),$("div.message").show(),$("div#user-form").bPopup().close();else{switch(t.status){case 2:setFieldInError($("input#user_email"));break;case 3:setFieldInError($("input#user_username"));break;case 4:setFieldInError($("input#user_lastname"));break;case 5:setFieldInError($("input#user_firstname"));break;case 6:setFieldInError($("input#user_password_confirm")),setFieldInError($("input#user_password"))}$("div.error").html(t.message),$("div.error").show()}})):void alert("Erreur, un opérateur doit être assigné à un projet")}function set_admin_project(){val_role=$("#role").val(),obj_projet=$("#projet"),("2"==val_role||"4"==val_role)&&($("#projet option:selected").removeAttr("selected"),obj_projet.find(":nth-child(1)").attr("selected","selected"))}function setFieldInError(e){e.css("backgroundColor","#ff0000"),e.focus()}function show_step_form(){var e=$("div#step-form");e.bPopup()}function change_step_value(){var e=$("#etp_id");0==$("#pro_id").val()?e.empty():$.ajax({url:userAjaxChangeStep,type:"post",data:{proj_id:$("#pro_id").val(),ut_id:$("#utilisateur_id").val()},dataType:"json",success:function(t){data_sent=t,e.empty();for(var s=0;s<t.length;s++)sel="","o"==t[s].selected&&(sel=" selected "),e.append('<option value="'+t[s].etape_id+'" '+sel+">"+t[s].libelle+"</option>")}})}function change_user_value(){var e=$("#pro_id");$.ajax({url:userAjaxChangeUser+"/"+$("#utilisateur_id").val(),type:"get",dataType:"json",success:function(t){if(data_sent2=t,e.empty(),"undefined"==typeof t.length)for(ligne in t)e.append('<option value="'+ligne+'">'+t[ligne]+"</option>");else for(var s=0;s<t.length;s++)e.append('<option value="'+s+'">'+t[s]+"</option>");change_step_value()}})}function valid_user_steps(){var e=$("div#step-form"),t=$("#utilisateur_id").val(),s=$("#pro_id").val(),r=$("#etp_id").val();return"0"==s?!1:null==r?!1:void $.ajax({url:userAjaxValidStep,type:"post",data:{data_user:t,data_steps:r,data_project:s},dataType:"json",success:function(){e.bPopup().close()}})}var oTable=null,objnom=null,objpre=null;$(document).ready(function(){change_user_value(),objnom=$("input#user_lastname"),objpre=$("input#user_firstname"),setInterval(refresh_fenetre,3e5),$("div.datatable-container").width($(window).width()-60),oTable=$("#user_list").dataTable({sAjaxSource:userAjaxBrowseURL,aoColumnDefs:[{bVisible:!1,bSearchable:!1,aTargets:[0]},{sClass:"center",aTargets:[9]}],fnRowCallback:function(e){$(e).addClass("dt-row-common")},aaSorting:[[1,"asc"]],sScrollY:calcDataTableHeight(),sDom:'<"H"Cfr>tS<"F"i>',bDeferRender:!0,bRetrieve:!0,bDestroy:!0,bProcessing:!0,bServerSide:!0,bAutoWidth:!0,bJQueryUI:!0,bStateSave:!1,sScrollX:"98%",sPaginationType:"full_numbers",oColVis:{aiExclude:[0],buttonText:"Afficher / masquer des colonnes",bRestore:!0,sRestore:"Afficher toutes les colonnes"},oLanguage:{oPaginate:{sFirst:"Début",sLast:"Fin",sNext:"Suivant",sPrevious:"Précédent"},sSearch:"Rechercher",sProcessing:"Chargement en cours...",sLengthMenu:'Lignes affichées: <select><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="-1">Toutes</option></select>',sZeroRecords:"Aucun résultat pour cette recherche",sInfo:"Lignes _START_ à _END_ (Total: _TOTAL_)",sInfoFiltered:" - Filtrées parmis _MAX_ lignes",sInfoEmpty:"Aucune donnée à afficher"}});var e=null;$(window).resize(function(){$("div.dataTables_scrollBody").css("height",calcDataTableHeight()),clearTimeout(e),e=setTimeout(resizeDataTable,100)}),$("#user_list tbody tr").live("click",tableRowClick)});var username=$("input#username").val();$("select#qsdqsd options").each(function(){return $(this).val()==username?!0:void 0});var hdl=null,ifound=0,calcDataTableHeight=function(){return 55*$(window).height()/100},data_sent,data_sent2;