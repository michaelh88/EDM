function addZeros(e,t){var a=e.toString().length;return 2>a?"0"+e:e}function getid_pro(){var e=$("#lot_identifiant").val();return e}function changeFiltreProjet(){var e=$("#data_lot"),t=$("#data_commande_vivetic"),a=$("#data_projet"),l=$("#data_nom_zip");a.on("change",function(){var a=$(this).val();""!=a&&$.ajax({type:"POST",url:lotAjaxChangeProjetURL,data:"projet_id="+a,dataType:"json",success:function(a){t.empty(),e.empty(),l.empty(),$.each(a.projet,function(t,a){e.append('<option value="'+a.lot_id+'">'+a.nom_zip+"</option>")}),$.each(a.nomzip,function(e,t){l.append('<option value="'+t.lot_id+'">'+t.nom_zip_original+"</option>")}),$.each(a.commande_vivetic,function(e,a){t.append('<option value="'+a.commande_vivetic+'">'+a.commande_vivetic+"</option>")})}})})}function resetProjet(){var e=$("#data_lot"),t=$("#data_commande_vivetic"),a=$("#data_nom_zip"),l=($("#data_projet"),document.getElementById("data_projet")),n="";for(i=0;i<l.length;i++)n+=l.options[i].value+",";t.empty(),e.empty(),a.empty(),$.ajax({type:"POST",url:lotAjaxChangeProjetURL,data:"projet_id="+n.substring(0,n.length-1),dataType:"json",success:function(l){$.each(l.projet,function(t,a){e.append('<option value="'+a.lot_id+'">'+a.nom_zip+"</option>")}),$.each(l.nomzip,function(e,t){a.append('<option value="'+t.lot_id+'">'+t.nom_zip_original+"</option>")}),$.each(l.commande_vivetic,function(e,a){t.append('<option value="'+a.commande_vivetic+'">'+a.commande_vivetic+"</option>")})}})}function tableRowClick(){if(1!=action_faire)action_faire=-1;else{action_faire=-1;var e=oTable.fnGetData(this),t=parseInt(e.lot_id),a=parseInt(e.nombre_doc),l=parseInt(e.avglobal);if(lot_message_id=t,update)return update=!1,$("#lot_identifiant").val(t),$("#upload_lot_code").text(e.nom_zip),void show_update_form();if(reset)reset=!1,confirm("Êtes-vous sûr de vouloir supprimer ce lot?")&&($.ajax({type:"POST",url:lotAjaxResetURL,data:"lot_id="+t}),oTable.fnDraw(!0));else{var i=e.nom_zip,n=$("div#lot-form"),o=$("div#etape_lot_form"),r=$("div#ecrire-message"),s=$("div#lecture-message"),d=null;n.find("input#f_lot_id").val(t),n.find("span#f_lot_code").text(i),n.find("span#f_message").text("Messages"),o.find("input#e_lot_id").val(t),o.find("span#e_lot_code").text(i),o.find("span#f_avancement").text("Suivi d'avancement"),r.find("input#m_lot_id").val(t),r.find("span#m_lot_code").text(i),r.find("span#m_message").text("Nouveau messages"),s.find("input#ml_lot_id").val(t),s.find("span#ml_lot_code").text(i),s.find("span#ml_message").text("Lecture de messages"),"notification"==redirection&&(showLotForm(),d=new ItpOverlay,$.ajax({type:"POST",url:lotAjaxDataURL,data:{lot_id:t,projet_id:l},dataType:"json",success:function(e){populateUsers(e.users)}}),$("div.datatable-container-message").width($("#lot-form").width()-17),$("#btn_maj").click(function(){getDataEtapeLot()}),setDataTableMessage()),"avancement"==redirection&&(showEtapeLotForm(),$("#slider-content").html(""),d=new ItpOverlay,$.ajax({type:"POST",url:lotAjaxGetEtapeLotURL,data:"lot_id="+t,dataType:"json",success:function(e){displayEtapeLot(e.data_etape_lot,a)}}))}}}function displayEtapeLot(e,t){var a=$("#f_etape_lot");a.empty();var l="";indexEtapeArr=[];var i=!1;if($.each(e,function(e,t){var a=t.etape_id,n=t.libelle,o=t.defaut,r="",s="",d=t.display;"0"==d?r="hidden":"0"==o&&(s="class='upload-step-vivetic'",i=!0),indexEtapeArr.push(a),l+="<div class='slider font-weight-style "+r,l+="'>",l+="<input type='hidden' id='hidden_"+a,l+="' value='"+o,l+="'/><label for='l_etape_"+a,l+="' id='label_etape_"+a,l+="'"+s,l+=">"+n+":</label><input class='etape-auto-width' type='text' id='l_etape_"+a,l+="' readonly />",l+="<input type='text' id='l_etape_"+a,l+="_pourcent' readonly class='purcent-av-lot' /><div id='etape_"+a,l+="' class='slider-style'></div></div>",$("#slider-content").html(l)}),i){var n="<label class='upload-step-vivetic'>Etapes non modifiables</label>";$("#legende-etape").html(n)}else $("#legende-etape").html("");$.each(e,function(e,a){var l=a.volume_doc,i=a.etape_id,n=a.defaut;3==role_user?$(function(){$("#etape_"+i).slider({range:"min",value:l,min:0,max:t,disabled:!0,slide:function(e,a){$("#l_etape_"+i).val(a.value+"/"+t),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape(a.value,t)+"%")}}),$("#l_etape_"+i).val($("#etape_"+i).slider("value")+"/"+t),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape($("#etape_"+i).slider("value"),t)+"%")}):"0"==n?$(function(){$("#etape_"+i).slider({range:"min",value:l,min:0,max:t,disabled:!0,slide:function(e,a){$("#l_etape_"+i).val(a.value+"/"+t),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape(a.value,t)+"%")}}),$("#l_etape_"+i).val($("#etape_"+i).slider("value")+"/"+t),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape($("#etape_"+i).slider("value"),t)+"%")}):i==indexEtapeArr[0]&&l==t?$(function(){$("#etape_"+i).slider({range:"min",value:l,min:0,max:t,disabled:!0,slide:function(e,a){$("#l_etape_"+i).val(a.value+"/"+t),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape(a.value,t)+"%")}}),$("#l_etape_"+i).val($("#etape_"+i).slider("value")+"/"+t),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape($("#etape_"+i).slider("value"),t)+"%")}):$(function(){$("#etape_"+i).slider({range:"min",value:l,min:0,max:t,slide:function(e,a){$("#l_etape_"+i).val(a.value+"/"+t),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape(a.value,t)+"%")}}),$("#l_etape_"+i).val($("#etape_"+i).slider("value/"+t)),$("#l_etape_"+i+"_pourcent").val(calculAvencementEtape($("#etape_"+i).slider("value"),t)+"%")})}),$.each(e,function(e,t){var a=t.display,l=t.etape_id;"0"==a&&$("#etp_"+l).css("display","none")}),$.each(e,function(e,a){var l=a.etape_id;0==e?($("#etape_"+l).slider({slide:function(a,i){return i.value<$("#etape_"+indexEtapeArr[e+1]).slider("value")?!1:($("#l_etape_"+l).val(i.value+"/"+t),void $("#l_etape_"+l+"_pourcent").val(calculAvencementEtape(i.value,t)+"%"))}}),$("#l_etape_"+l).val($("#etape_"+l).slider("value")+"/"+t),$("#l_etape_"+l+"_pourcent").val(calculAvencementEtape($("#etape_"+l).slider("value"),t)+"%")):e>0&&($("#etape_"+l).slider({slide:function(a,i){return i.value>$("#etape_"+indexEtapeArr[e-1]).slider("value")?!1:i.value<$("#etape_"+indexEtapeArr[e+1]).slider("value")?!1:($("#l_etape_"+l).val(i.value+"/"+t),void $("#l_etape_"+l+"_pourcent").val(calculAvencementEtape(i.value,t)+"%"))}}),$("#l_etape_"+l).val($("#etape_"+l).slider("value")+"/"+t),$("#l_etape_"+l+"_pourcent").val(calculAvencementEtape($("#etape_"+l).slider("value"),t)+"%"))})}function getDataEtapeLot(){for(var e=$("#e_lot_id").val(),t=[],a=0;a<indexEtapeArr.length;a++)if("1"==$("#hidden_"+indexEtapeArr[a]).val()){var l=$("#label_etape_"+indexEtapeArr[a]).html();l=l.substring(0,l.length-1);var i=$("#etape_"+indexEtapeArr[a]).slider("value"),n=l+","+i;t.push(n)}$.ajax({type:"POST",url:lotAjaxUpdateEtapeURL,data:{lot_id:e,data:t},success:function(){alert("Mise à jour des étapes effectuées")}})}function calculAvencementEtape(e,t){var a=e/t*100;return isInteger(a)?a:Math.round(a)}function roundFloat(e){var t=e/1;return isInteger(t)?t:t.toFixed(2)}function isInteger(e){return e%1===0}function populateUsers(e){var t=$("#f_data_users");t.empty(),$.each(e,function(e,a){t.append('<option value="'+a.id+'">'+a.userfirstname+" "+a.userlastname+"</option>")})}function showLotForm(){var e=$("div#lot-form");$("div.error").hide(),e.bPopup({fadeSpeed:"fast",followSpeed:"fast",onClose:function(){oTable.fnDraw()}})}function showEtapeLotForm(){var e=$("div#etape_lot_form");$("div.error").hide(),e.bPopup({fadeSpeed:"fast",followSpeed:"fast",onClose:function(){$("#legende-etape").html(""),oTable.fnDraw()}})}function refresh_fenetre(){oTable.fnDraw(!0)}function refreshDataTable(){setInterval(refresh_fenetre,3e5);var e=null;$(window).resize(function(){$(".datatable-container div.dataTables_scrollBody").css("height",calcDataTableHeight()),clearTimeout(e),e=setTimeout(resizeDataTable,300)})}function resizeDataTable(){oTable.fnAdjustColumnSizing(),resizeWidthFiltre(),$(".datatable-container div.dataTables_scrollBody").css("height",calcDataTableHeight()),$(".datatable-container-message div.dataTables_scrollBody").css("height","290"),$("div.datatable-container").width($(window).width()-60)}function setFieldInError(e){e.css("backgroundColor","#ff0000"),e.focus()}function sendFiltreAvancement(){var e=$("#data_projet").val(),t="",a="0";if(null!=e)for(var l="",i=e.length,n=0;i>n;n++)l+=e[n],i-1>n&&(l+="#");else l="";var o=$("#data_commande_vivetic").val();if(null!=o)for(var r="",i=o.length,n=0;i>n;n++)r+=o[n],i-1>n&&(r+="#");else r="";var s=$("#data_lot").val();if(null!=s)for(var d="",c=s.length,n=0;c>n;n++)d+=s[n],c-1>n&&(d+="#");else d="";var _=$("#data_nom_zip").val();if(null!=_)for(var u="",c=_.length,n=0;c>n;n++)u+=_[n],c-1>n&&(u+="#");else u="";var p=$("#data_etat").val();if(null!=p)for(var f="",i=p.length,n=0;i>n;n++)f+=p[n],i-1>n&&(f+=",");else f="";var v=$("#data_datetime_creation").val();if(""!=v){var m=new RegExp("(/)","g");v=v.replace(m,"_");var m=new RegExp("(à)","g");v=v.replace(m,"|")}$.ajax({type:"POST",url:lotAjaxAvancementGlobalURL,data:{filtre:1,data_projet:l,data_datetime_creation:v,data_commande_vivetic:r,data_lot:d,data_nom_zip:u,data_etat:f},dataType:"json",success:function(e){showAvancementGlobal(),$("#avancement-content").html(t),$.each(e,function(e,l){var i="",n=l.projet_id,o=l.nom_projet,r=l.libelle,s=l.volume_pourcent,d=l.display;0==d&&(i="hidden"),n!=a&&(t+="<div class='projet_titre'><span>"+o,t+=":</span></div>",a=n),t+="<div class='etape_label "+i,t+="'><label>"+r,t+=": </label>	<span class='purcent-av-global'>"+roundFloat(s),t+="%</span></div>",$("#avancement-content").html(t)})}})}function createMessage(){var e=$("#message_objet").val(),t=$("#message_texte").val(),a=$("#f_data_users").val(),l=$("input#m_lot_id").val();$.ajax({type:"POST",url:lotAjaxCreateMessageURL,data:{lot_id:l,objet:e,texte:t,users:a},dataType:"json",success:function(e){if(0==e.status){alert("Votre message a été envoyé avec succès");var t=$("div#ecrire-message");return t.bPopup().close(),!0}alert(e.message)}})}function sendfiltre(){var e=$("#data_projet").val();if(null!=e)for(var t="",a=e.length,l=0;a>l;l++)t+=e[l],a-1>l&&(t+="#");else t="";var i=$("#data_datetime_creation").val();if(""!=i){var n=new RegExp("(/)","g");i=i.replace(n,"_");var n=new RegExp("(à)","g");i=i.replace(n,"|")}$.ajax({type:"POST",url:lotAjaxExportStatistiqueURL,data:{projet_id:t,date_creation:i}})}function sendParameters(){var e="",t="",a="",l=1,l=($(".selectFiltreAjout").length,$(".dateFiltre").length,$(".champFiltre").length,1),i=$("#data_projet").val();if(null!=i)for(var n="",o=i.length,l=0;o>l;l++)n+=i[l],o-1>l&&(n+="#");else n="";var r=$("#data_commande_vivetic").val();if(null!=r)for(var s="",o=r.length,l=0;o>l;l++)s+=r[l],o-1>l&&(s+="#");else s="";var d=$("#data_lot").val();if(null!=d)for(var c="",_=d.length,l=0;_>l;l++)c+=d[l],_-1>l&&(c+="#");else c="";var u=$("#data_etat").val();if(null!=u)for(var p="",o=u.length,l=0;o>l;l++)p+=u[l],o-1>l&&(p+="|");else p="";var f=$("#data_datetime_creation").val();if(""!=f){var v=new RegExp("(/)","g");f=f.replace(v,"_");var v=new RegExp("(à)","g");f=f.replace(v,"|")}var m=$("#data_nom_zip").val();if(null!=m)for(var g="",_=m.length,l=0;_>l;l++)g+=m[l],_-1>l&&(g+="#");else g="";dataSend=[1,i,r,d,u,f,m,e,t,a],setDataTable(),oTable.fnDraw(!0)}function setDataTable(){var e=new Date,t="GED_FTHM_"+e.getFullYear()+addZeros(e.getMonth()+1,2)+addZeros(e.getDate(),2)+"_"+addZeros(e.getHours(),2)+addZeros(e.getMinutes(),2)+addZeros(e.getSeconds(),2)+"_LISTE_VALISES_COMPTABLES";oTable="6"==role_user?$("#lot_list").dataTable({sServerMethod:"POST",sAjaxSource:lotAjaxBrowseURL,aoColumns:[{mData:"lot_id",visible:!1},{mData:"nom_projet"},{mData:"commande_vivetic"},{mData:"datetime_creation"},{mData:"nombre_doc"},{mData:"nom_zip_original"},{mData:"etat"},{mData:"nom_zip"},{mData:"createur_lot"},{mData:"datetime_modification"},{mData:"modificateur_lot"},{mData:"datetime_validation"},{mData:"volume_piece"},{mData:"avancement_globale"},{mData:"nb_notif"},{mData:"duree_traitement"},{mData:"telechargement"},{mData:"avglobal",visible:!1}],aoColumnDefs:[{bVisible:!1,bSearchable:!1,aTargets:[0,2,11,17]},{sClass:"center",aTargets:[1,3,4,6,7,12,15,16]},{sClass:"center",bVisible:!1,aTargets:[5,8,9,10]}],fnRowCallback:function(e,t,a,l){$(e).addClass("dt-row-common"),t.notif>0&&$(e).css("background-color","#f9dc1b"),$(".ColVis_collection").css("width",240),$(".ColVis_Button").css("width",240)},fnServerParams:function(e){e.push({name:"filtre",value:dataSend[0]},{name:"data_projet",value:dataSend[1]},{name:"data_commande_vivetic",value:dataSend[2]},{name:"data_lot",value:dataSend[3]},{name:"data_etat",value:dataSend[4]},{name:"data_datetime_creation",value:dataSend[5]},{name:"data_nom_zip",value:dataSend[6]},{name:"sendValSelect",value:dataSend[7]},{name:"sendValDate",value:dataSend[8]},{name:"sendValChamp",value:dataSend[9]})},aaSorting:[[0,"asc"]],sScrollY:calcDataTableHeight(),sDom:'<"H"CrT>tS<"F"i>',bDeferRender:!0,bRetrieve:!0,bDestroy:!0,bProcessing:!0,bServerSide:!0,bAutoWidth:!0,bJQueryUI:!0,bStateSave:!0,sScrollX:"98%",sPaginationType:"scrolling",fnDrawCallback:function(e){},oColVis:{aiExclude:[0,2,11,17],buttonText:"Afficher / masquer des colonnes",bRestore:!0,sRestore:"Restaurer",bShowAll:!0,sShowAll:"Afficher toutes"},oLanguage:{oPaginate:{sFirst:"Début",sLast:"Fin",sNext:"Suivant",sPrevious:"Précédent"},sSearch:"Rechercher",sProcessing:"Chargement en cours...",sLengthMenu:'Lignes affichées: <select><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="-1">Toutes</option></select>',sZeroRecords:"Aucun résultat pour cette recherche",sInfo:"Lignes _START_ à _END_",sInfoFiltered:" - Filtrées parmis _MAX_ lignes",sInfoEmpty:"Aucune donnée à afficher"},oScroller:{loadingIndicator:!1,rowHeight:"30",autoHeight:!1},oTableTools:{sSwfPath:"../public/flash/copy_csv_xls_pdf.swf",aButtons:[{sExtends:"xls",sButtonText:"Exporter en Excel",mColumns:[1,3,4,5,6,7,8,9,10,12,13,14,15],sFileName:t+".xls"}]}}):$("#lot_list").dataTable({sServerMethod:"POST",sAjaxSource:lotAjaxBrowseURL,aoColumns:[{mData:"lot_id",visible:!1},{mData:"nom_projet"},{mData:"commande_vivetic"},{mData:"datetime_creation"},{mData:"nombre_doc"},{mData:"nom_zip_original"},{mData:"etat"},{mData:"nom_zip"},{mData:"createur_lot"},{mData:"datetime_modification"},{mData:"modificateur_lot"},{mData:"datetime_validation"},{mData:"volume_piece"},{mData:"avancement_globale"},{mData:"nb_notif"},{mData:"duree_traitement"},{mData:"telechargement"},{mData:"avglobal",visible:!1}],aoColumnDefs:[{bVisible:!1,bSearchable:!1,aTargets:[0,17]},{sClass:"center",aTargets:[1,3,4,6,7,12,15,16]},{sClass:"center",bVisible:!1,aTargets:[2,5,8,9,10,11]}],fnRowCallback:function(e,t,a,l){$(e).addClass("dt-row-common"),t.notif>0&&$(e).css("background-color","#f9dc1b"),$(".ColVis_collection").css("width",240),$(".ColVis_Button").css("width",240)},fnServerParams:function(e){e.push({name:"filtre",value:dataSend[0]},{name:"data_projet",value:dataSend[1]},{name:"data_commande_vivetic",value:dataSend[2]},{name:"data_lot",value:dataSend[3]},{name:"data_etat",value:dataSend[4]},{name:"data_datetime_creation",value:dataSend[5]},{name:"data_nom_zip",value:dataSend[6]},{name:"sendValSelect",value:dataSend[7]},{name:"sendValDate",value:dataSend[8]},{name:"sendValChamp",value:dataSend[9]})},aaSorting:[[0,"asc"]],sScrollY:calcDataTableHeight(),sDom:'<"H"CrT>tS<"F"i>',bDeferRender:!0,bRetrieve:!0,bDestroy:!0,bProcessing:!0,bServerSide:!0,bAutoWidth:!0,bJQueryUI:!0,bStateSave:!0,sScrollX:"98%",sPaginationType:"scrolling",fnDrawCallback:function(e){},oColVis:{aiExclude:[0,17],buttonText:"Afficher / masquer des colonnes",bRestore:!0,sRestore:"Restaurer",bShowAll:!0,sShowAll:"Afficher toutes"},oLanguage:{oPaginate:{sFirst:"Début",sLast:"Fin",sNext:"Suivant",sPrevious:"Précédent"},sSearch:"Rechercher",sProcessing:"Chargement en cours...",sLengthMenu:'Lignes affichées: <select><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="-1">Toutes</option></select>',sZeroRecords:"Aucun résultat pour cette recherche",sInfo:"Lignes _START_ à _END_",sInfoFiltered:" - Filtrées parmis _MAX_ lignes",sInfoEmpty:"Aucune donnée à afficher"},oScroller:{loadingIndicator:!1,rowHeight:"28",autoHeight:!1},oTableTools:{sSwfPath:"../public/flash/copy_csv_xls_pdf.swf",aButtons:[{sExtends:"xls",sButtonText:"Exporter en Excel",mColumns:[1,3,4,5,6,7,8,9,10,12,13,14,15],sFileName:t+".xls"}]}}),refreshDataTable()}function tableRowClickMessage(){if(showReadMessage(),"Aucune donnée trouvée"!=$("#message_list tbody tr td").html()){var e=oTableMessage.fnGetData(this),t=e.objet,a=e.texte_message,l=e.datetime_lecture,i=e.lupar,n=e.message_user_id,o=$("input#ml_lot_id").val();$("#objet_message span").text(t),$("#texte_message p").text(a),null!=i?$("#lupar label").text("Lu par:"+i):$("#lupar label").text(""),null==l&&$.ajax({type:"POST",url:lotAjaxUpdateEtatMessageURL,data:{lot_id:o,message_user_id:n}})}}function setDataTableMessage(){oTableMessage=$("#message_list").dataTable({sServerMethod:"POST",sAjaxSource:messageAjaxBrowseURL,aoColumns:[{mData:"message_user_id",visible:!1},{mData:"objet"},{mData:"datetime_creation"},{mData:"createur_id"},{mData:"etat"}],aoColumnDefs:[{bVisible:!1,bSearchable:!1,aTargets:[0]},{sClass:"center",aTargets:[2,3,4]},{sWidth:"550",aTargets:[1]}],fnRowCallback:function(e,t,a,l){$(e).addClass("dt-row-common")},fnServerParams:function(e){e.push({name:"lot_id",value:lot_message_id})},aaSorting:[[0,"asc"]],sScrollY:"290px",sDom:'<"H"r>tS<"F"i>',bDeferRender:!0,bRetrieve:!0,bDestroy:!0,bProcessing:!0,bServerSide:!0,bAutoWidth:!0,bJQueryUI:!0,bStateSave:!1,sScrollX:"98%",sPaginationType:"scrolling",fnDrawCallback:function(e){$("#loading_data").css("display","none"),$("#lot_list_wrapper").css("z-index","0")},oLanguage:{oPaginate:{sFirst:"Début",sLast:"Fin",sNext:"Suivant",sPrevious:"Précédent"},sSearch:"Rechercher",sProcessing:"Chargement en cours...",sLengthMenu:'Lignes affichées: <select><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="-1">Toutes</option></select>',sZeroRecords:"Aucun résultat pour cette recherche",sInfo:"Lignes _START_ à _END_ ",sInfoFiltered:" - Filtrées parmis _MAX_ lignes",sInfoEmpty:"Aucune donnée à afficher"},oScroller:{loadingIndicator:!1}}),oTableMessage.fnDraw(!0)}function refresh_fenetre_message(){oTableMessage.fnDraw(!0),console.log("ato"),$("div.dataTables_scrollBody").css("height","290")}function refreshDataTableMessage(){setInterval(refresh_fenetre_message,3e5);var e=null;$(window).resize(function(){$("div.dataTables_scrollBody").css("height","290"),$("div.dataTables_scrollBody").css("overflow-x","hidden"),clearTimeout(e)})}function unselect(e){$("#"+e).find($("option")).attr("selected",!1),"#"+e=="#data_projet"&&resetProjet()}function do_click(e){action_faire=1,redirection=e}function resetLotClick(){action_faire=1,reset=!0}function updateLotClick(){action_faire=1,update=!0}function resizeWidthFiltre(){var e=$(".filtre_contenu").width(),t=200,a=$(".div_filtre").length;$(".filtre_contenu").height(""),$("#filtre_datatable").height(""),e>t*a+120?($(".filtre_contenu").height(94),$("#filtre_datatable").height(131)):e>t*(a-1)+100?($(".filtre_contenu").height($("div.div_filtre").height()+$("div.div_filtre1").height()+6),$("#filtre_datatable").height($(".filtre_contenu").height()+$("div.div_filtre_btn").height()+12)):e>t*(a-2)+80?($(".filtre_contenu").height(2*$("div.div_filtre").height()+24),$("#filtre_datatable").height($(".filtre_contenu").height()+$("div.div_filtre_btn").height()+12)):e>t*(a-3)+60?($(".filtre_contenu").height(2*$("div.div_filtre").height()+24),$("#filtre_datatable").height($(".filtre_contenu").height()+$("div.div_filtre_btn").height()+12)):e>t*(a-4)+40&&($(".filtre_contenu").height(3*$("div.div_filtre").height()+36),$("#filtre_datatable").height($(".filtre_contenu").height()+$("div.div_filtre_btn").height()+12))}function showFormMessage(){var e=$("div#ecrire-message");$("#message_objet").val(""),$("#message_texte").val(""),$("div.error").hide(),e.bPopup({fadeSpeed:"fast",followSpeed:"fast",onClose:function(){oTableMessage.fnDraw()}})}function showReadMessage(){var e=$("div#lecture-message");$("div.error").hide(),e.bPopup({fadeSpeed:"fast",followSpeed:"fast",onClose:function(){oTableMessage.fnDraw()}})}function showAvancementGlobal(){var e=$("div#avancement-global-form");$("div.error").hide(),e.bPopup({fadeSpeed:"fast",followSpeed:"fast",onClose:function(){}})}function readMessageClick(e,t){$.ajax({type:"POST",url:lotAjaxGetMessageURL,data:{message_user_id:e},dataType:"json",success:function(a){var l=$("div#lecture-message");$("div.error").hide(),l.bPopup({onClose:function(){oTable.fnDraw()}}),$.each(a,function(a,i){var n=i.lot_id,o=i.objet,r=i.texte_message;i.user_id;l.find("input#ml_lot_id").val(n),l.find("span#ml_lot_code").text(t),l.find("span#ml_message").text("Lecture de messages"),$("#objet_message span").text(o),$("#texte_message p").text(r),$.ajax({type:"POST",url:lotAjaxUpdateEtatMessageURL,data:"message_user_id="+e})})}})}function filtre_param_alert_messagenonlu(e){data_projet="",data_commande_vivetic="",data_lot="",data_etat="",data_datetime_creation="",data_nom_zip="",sendValSelect="",sendValDate="",sendValChamp="",data_lot=e,dataSend=[1,data_projet,data_commande_vivetic,data_lot,data_etat,data_datetime_creation,data_nom_zip,sendValSelect,sendValDate,sendValChamp],setDataTable(),oTable.fnDraw(!0)}function filtre_param_alert_lot(){data_projet="",data_commande_vivetic="",data_lot="",data_etat="",data_datetime_creation="",data_nom_zip="",sendValSelect="",sendValDate="",sendValChamp="",data_etat="Alerte délai",dataSend=[1,data_projet,data_commande_vivetic,data_lot,data_etat,data_datetime_creation,data_nom_zip,sendValSelect,sendValDate,sendValChamp],setDataTable(),oTable.fnDraw(!0)}function show_update_form(){$("#files").empty(),$(".progress-bar-success").width("0%");var e=$("div#updatelot_form");e.bPopup({onClose:function(){oTable.fnDraw()}})}function before_upload(){return $("#files").empty(),$("#progress .progress-bar").css("width","0%"),$("#fileupload").fileupload({url:url_upl+get_lot_value_upload(),dataType:"json",send:function(e,t){for(var a=0;a<t.originalFiles.length;a++)if(t.originalFiles[a].type.indexOf("zip")>=0||t.originalFiles[a].type.indexOf("octet-stream")>=0)return $("#files").html('<span class="upload-fail">Fichier autre que zip importé</span>'),!1},done:function(e,t){console.log(t.result),$("<p/>").html(t.result).appendTo("#files")},progressall:function(e,t){var a=parseInt(t.loaded/t.total*100,10);$("#progress .progress-bar").css("width",a+"%")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),!1}function download_lot(e,t){return""==e?!1:""==t?!1:void $.ajax({url:lotAjaxDowloadFile,type:"POST",data:{data:e,lot:t},success:function(a){a?(surl="../misc/download/"+e+"/"+t+".zip",window.location.href=surl):alert("Fichier non disponible")}})}var oTable=null,oTableMessage=null,b_scroll_filtre_prec=!0,b_scroll_filtre=!0,affichage_av_global=!1,reset=!1,update=!1,objnom=null,i_taille_filtre=0,difference=0,role_user="2",objpre=null,action_faire=-1,redirection="vers",dataSend=[1,"","","","","","","","",""],indexEtapeArr=[],lot_message_id=0,rowHeight=0,uri="",datetime="",name="*Liste_lot_11/11/1111",filename="",calcHeightTableMessage=function(){return $("#lot-form").height()-70},calcDataTableHeight=function(){if(b_scroll_filtre_prec!=b_scroll_filtre){var e=i_taille_filtre;b_scroll_filtre_prec=b_scroll_filtre}else var e=$("#filtre_datatable").height();if(b_scroll_filtre)if(i_taille_filtre!=e){var t=e-i_taille_filtre;Math.abs(t)<10?(e=0,difference=e):(i_taille_filtre=$("#filtre_datatable").height(),e=-t+difference,difference=e)}else e=difference;else e+=difference;return $(window).height()>590?(rowHeight=$("#lot_list tbody tr").height(),$(window).height()-295+e):(rowHeight=$("#lot_list tbody tr").height(),59*$(window).height()/100+e)};$(document).ready(function(){var e=new Date;"*_liste_dossier_"+e.getFullYear()+"."+addZeros(e.getMonth()+1,2)+"."+addZeros(e.getDate(),2)+"_"+addZeros(e.getHours(),2)+"."+addZeros(e.getMinutes(),2);resizeWidthFiltre(),setInterval(refresh_fenetre,3e5),$("div.datatable-container").width($(window).width()-60),role_user=$("#client").html(),setDataTable();var t=null;$(window).resize(function(){clearTimeout(t),t=setTimeout(resizeDataTable,100)}),$("#cacherDiv").click(function(){b_scroll_filtre=!1;$("#filtre_datatable").height();$("#filtre_datatable").hide("slow"),$("#cacherDiv").css("display","none"),$("#afficherDiv").css("display","block"),$("div.dataTables_scrollBody").css("height",calcDataTableHeight())}),$("#afficherDiv").click(function(){b_scroll_filtre=!0,$("#filtre_datatable").show("slow"),$("#cacherDiv").css("display","block"),$("#afficherDiv").css("display","none"),$("div.dataTables_scrollBody").css("height",calcDataTableHeight())}),$("#data_datetime_creation").dateRangePicker({format:"DD/MM/YYYY",separator:" à "}),$("#btn_rechercher").click(function(){affichage_av_global=!1,sendParameters()}),$("#btn_reinitialiser").click(function(){resetProjet(),$("#form_filtre_lot")[0].reset(),sendParameters()}),$("#btn_maj").click(function(){getDataEtapeLot()}),$("#btn_export_statistique").click(function(){sendfiltre()}),$("#btn_avancement_global").click(function(){sendFiltreAvancement()}),changeFiltreProjet(),$("#lot_list tbody tr").live("click",tableRowClick),$("#message_list tbody tr").live("click",tableRowClickMessage);var a=$('[id^="img_"]'),l=document.getElementById(a[0].getAttribute("id"));l.addEventListener("click",function(e){e.preventDefault(),unselect(l.getAttribute("data-id"))});var i=document.getElementById(a[1].getAttribute("id"));i.addEventListener("click",function(e){e.preventDefault(),unselect(i.getAttribute("data-id"))});var n=document.getElementById(a[2].getAttribute("id"));n.addEventListener("click",function(e){e.preventDefault(),unselect(n.getAttribute("data-id"))});var o=document.getElementById(a[3].getAttribute("id"));o.addEventListener("click",function(e){e.preventDefault(),unselect(o.getAttribute("data-id"))});var r=document.getElementById(a[4].getAttribute("id"));r.addEventListener("click",function(e){e.preventDefault(),unselect(r.getAttribute("data-id"))});var s=document.getElementById(a[5].getAttribute("id"));s.addEventListener("click",function(e){e.preventDefault(),$("#"+s.getAttribute("data-id")).val("")}),uri=window.location.href.slice();var d=[];if(d=uri.split("/"),"list"!=d[d.length-1]){data_projet="",data_commande_vivetic="",data_lot="",data_etat="",data_datetime_creation="",data_nom_zip="",sendValSelect="",sendValDate="",sendValChamp="";var c=atob(d[d.length-1]),_=[];_=c.split(";"),data_lot=_[0],data_etat=_[1],dataSend=[1,data_projet,data_commande_vivetic,data_lot,data_etat,data_datetime_creation,data_nom_zip,sendValSelect,sendValDate,sendValChamp],setDataTable(),oTable.fnDraw(!0),uri=""}$("#uploader").plupload({runtimes:"html5,flash,silverlight",url:"../../Import/ajax_update_plupload/",multipart:!0,multipart_params:{key:"${filename}",Filename:"${filename}",acl:"public-read","Content-Type":"application/zip"},multi_selection:!1,chunk_size:"10000kb",max_retries:3,file_data_name:"file",filters:{max_file_size:"256mb",mime_types:[{title:"zip files",extensions:"zip"}]},flash_swf_url:"../../../public/js/lib/Moxie.swf",silverlight_xap_url:"../../../public/js/lib/Moxie.xap",init:{BeforeUpload:function(e,t){filename="",e.settings.url="../../Import/ajax_update_plupload/"+getid_pro(),$("#loading_data").css("display","block")},UploadFile:function(e,t){filename=t.name,$("#id_traitement").html(""),$("#id_traitement").html("Traitement du fichier "+filename+" en cours")},Error:function(e,t){$("#files").html("\nError #"+t.code+": "+t.info)},FileUploaded:function(e,t,a){var l=jQuery.parseJSON(a.response);$("<p/>").html(l.message).appendTo("#files"),$("#loading_data").css("display","none"),$("#id_traitement").html("")}}}),$("#uploader_start").click(function(){$("#files").html("")}),$("#uploader_stop").click(function(){$("#loading_data").css("display","none")})});var url_upl="../Import/post_update_upload/",get_lot_value_upload=function(){return ret=$("#lot_identifiant").val(),ret};